# Music Reviews Platform
Не финальная версия приложения (в данный момент происходит миграция на TanStack Query)

## 1. Краткое описание
Платформа для управления и просмотра музыкальных релизов, авторов, отзывов, медиа-материалов, рейтингов, комментариев и пользовательского контента. Включает административную панель (dashboard) и публичные страницы. Проект построен как монорепозиторий с двумя приложениями: `client` (React + Vite) и `server` (NestJS + Prisma + PostgreSQL).

## 2. Основной функционал
- Управление релизами (создание, редактирование, типы, медиа).
- Верификация авторов и подтверждение статусов.
- Система отзывов, комментариев, рейтингов и избранного.
- Лента и статистика (список самых активных пользователей, платформенная аналитика).
- Модерация пользовательского контента (обратная связь, подтверждения авторов).
- Адаптивный интерфейс.
- Уведомления и обработка ошибок (через централизованный NotificationStore / React Query callbacks).

## 3. Технологический стек
**Frontend (client):**
- React 18 + TypeScript
- Vite
- MobX
- TanStack React Query
- TailwindCSS
- React Router
- Модульная архитектура страниц / компонентов

**Backend (server):**
- NestJS
- TypeScript
- Prisma ORM
- PostgreSQL
- JWT

**Инфраструктура и инструменты:**
- ESLint (статический анализ)
- .env конфигурация (отдельно для клиента и сервера)
- Axios для HTTP (на клиенте выделен `api-instance.ts`)

## 4. Архитектура и структура репозитория
```
project-root/
  client/                 # фронтенд приложение
    src/
      api/                # слой запросов к REST API
      components/         # переиспользуемые UI компоненты
      contexts/           # контекст-обертки (UI, store)
      hooks/              # кастомные React hooks
      pages/              # страницы
      providers/          # контекст-провайдеры
      routes/             # навигация
      types/              # вспомогательные типы
      query-keys/         # ключи для React Query
      models/             # типы и интерфейсы доменной области
      stores/             # MobX сторы
      utils/              # вспомогательные функции
  server/                 # backend (NestJS)
    public/               # статические файлы (аватары, обложки, медиа)
    prisma/               # схема, миграции, сиды
    src/
      auth/               # аутентификация (стратегии, guards)
      authors/            # управление авторами
      decorators          # кастомные декораторы
      author-types/       # типы авторов
      feedbacks/          # отзывы/обратная связь
      mails/              # шаблоны email-ответов
      feedback-statuses/  # статусы обратной связи
      releases/           # релизы и связанные сущности
      reviews/            # отзывы о релизах
      profiles/           # профили пользователей
      leaderboard/        # статистика и рейтинги
      roles/              # роли и права
      social-media/       # соц. медиа атрибуты
      uploads/            # управление пользовательской загрузкой
      ...
```

### Ключевые принципы архитектуры
- Разделение ответственности: каждый модуль NestJS инкапсулирует свою область.
- На клиенте — слои: API + Hooks + Query Keys + Components + Pages.
- Данные поднимаются через React Query, локальное состояние минимально.
- Чёткая типизация интерфейсов домена в папке `models/`.

## 5. База данных (PostgreSQL + Prisma)
**Основные сущности (Список всех сущностей можно найти в `server/prisma/**`):**
- User / Profile — учётные записи и расширенная информация.
- Author — сущность автора (связь с пользователем / профилем), типы авторов (author-types), подтверждения.
- Release — музыкальный релиз (artists, designers, producers, rating types, media). Отдельные таблицы для связей N:M.
- Review — отзывы о релизах (оценки, текст, пользовательские взаимодействия).
- Feedback — пользовательская обратная связь (статусы модерации).
- AuthorConfirmation — заявки на верификацию авторов (статусы: PENDING, APPROVED, REJECTED).
- SocialMedia, Roles, Nominations, Leaderboard — поддерживающие и аналитические структуры.
- и др.

**Особенности:**
- Использование enum-типов для статусов (на уровне модели и UI).
- Жёсткая целостность через внешние ключи и каскадные ограничения.
- Миграции управляются через Prisma (`prisma migrate dev`).
- Сидирование (`seed.ts`) для начальных данных (статусы, роли и т.п.).
- Использование представлений, триггеров, функций и процедур.

## 6. Слой данных на клиенте (React Query)
- Ключи запросов централизованы (`query-keys/*`), что упрощает инвалидацию.
- Метаданные (статусы, типы) грузятся отдельными hooks (`use-*meta`) с бесконечным `staleTime` для оптимизации.
- Мутации (создание/обновление/удаление) используют `onSuccess` для инвалидации соответствующих ключей и генерации уведомлений. (В данный момент на стадии доработки)
- Обработка ошибок унифицирована (AxiosError -> показ уведомлений пользователю).

## 7. UI / Компонентный подход
- Множество атомарных кнопок и модальных окон (`components/buttons/*`, `components/modals/*`).
- Скелетоны (`SkeletonLoader`) для состояния загрузки.
- Пагинация — универсальный компонент.
- Фильтры и сортировки — повторяемый шаблон (статусы, типы, порядок `ASC/DESC`).

## 8. Качество кода
- TypeScript повсеместно (строгая типизация домена).
- ESLint конфигурации отдельно для клиентской и серверной части.
- Читабельные, сегментированные папки, минимум «god objects».
- Отделение бизнес-логики (NestJS services) от транспортного слоя (controllers).
- Использование DTO и валидации (decorators в сервере).
